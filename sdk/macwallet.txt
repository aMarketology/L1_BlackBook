â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      MAC'S BLACKBOOK WALLET - V2 (MIGRATED)                  â•‘
â•‘                      Fork Architecture with AES-GCM Encryption                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ WALLET IDENTIFICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

L1 Address:       L1_94B3C863E068096596CE80F04C2233B72AE11790
L2 Address:       L2_94B3C863E068096596CE80F04C2233B72AE11790
Public Key:       ec6941c71740e192bbf5933d5f9cc18ea161329ce864da900d8de73d45c28752

Username:         mac_blackbook
Email:            mac@blackbook.io
Created:          2026-01-24T05:12:36.477Z
Migrated:         2026-01-24T05:12:36.478Z
Chain:            BlackBook L1
Curve:            Ed25519


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” FORK ARCHITECTURE V2 (AES-GCM VAULT)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Auth Salt:        c797f810b635e1ea6c19bd0a1f1ef2d40ea565a03fd20eec9aa0350e88fa81a7
Vault Salt:       41176c59b52a392d6abaf26857ae97ab97c0733852d81fbd586f08ce12a9492b

Vault Algorithm:  AES-256-GCM
Vault KDF:        Argon2id
KDF Memory:       64 MB
KDF Iterations:   3
KDF Parallelism:  4

Ciphertext:       4q/jTciq0L6MaVz5tnLJQ7Rxu/owxXwPu2Fk6LCVHWlyP6O1HHbdEfj5B0bwl+N9...
Nonce:            7d23f1f893dfdad678080b7d

âš ï¸ TEST PASSWORD:  MacSecurePassword2026!
   (In production, user provides their own secure password)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”‘ FORK ARCHITECTURE - How It Works
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

USER ENTERS PASSWORD â†’ SPLIT INTO TWO KEYS:

1. AUTH KEY (for server authentication):
   auth_key = SHA256(AUTH_DOMAIN + auth_salt + password)
   â†’ Sent to server (server stores bcrypt(auth_key))
   â†’ Used for login authentication only

2. VAULT KEY (for vault decryption):
   vault_key = Argon2id(VAULT_DOMAIN + vault_salt + password)
   â†’ NEVER sent to server
   â†’ Stays in browser/client
   â†’ Used to decrypt vault

SERVER CANNOT DECRYPT VAULT because:
- Server only has bcrypt(auth_key), not auth_key itself
- Server never receives vault_key
- Vault key is derived with different domain separator


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ DECRYPTION CODE (Frontend)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// Import required libraries
import argon2 from 'argon2-browser';

async function unlockMacWallet(password, vaultData) {
    // Step 1: Derive vault key from password
    const vaultDomain = "BLACKBOOK_VAULT_V2" + vaultData.vault_salt;
    const vaultKeyResult = await argon2.hash({
        pass: vaultDomain + password,
        salt: vaultData.vault_salt,
        time: 3,
        mem: 65536,  // 64 MB
        parallelism: 4,
        hashLen: 32,
        type: argon2.ArgonType.Argon2id
    });
    
    // Step 2: Import key for Web Crypto API
    const cryptoKey = await crypto.subtle.importKey(
        'raw',
        vaultKeyResult.hash,
        { name: 'AES-GCM' },
        false,
        ['decrypt']
    );
    
    // Step 3: Decrypt vault
    const encoder = new TextEncoder();
    const aad = encoder.encode(vaultData.vault_salt);
    const nonceBytes = hexToBytes(vaultData.vault_nonce);
    const ciphertextBytes = Uint8Array.from(
        atob(vaultData.vault_ciphertext),
        c => c.charCodeAt(0)
    );
    
    const decrypted = await crypto.subtle.decrypt(
        {
            name: 'AES-GCM',
            iv: nonceBytes,
            additionalData: aad
        },
        cryptoKey,
        ciphertextBytes
    );
    
    const seedHex = new TextDecoder().decode(decrypted);
    
    // Step 4: Derive keypair from seed
    const seedBytes = hexToBytes(seedHex);
    const keypair = nacl.sign.keyPair.fromSeed(seedBytes);
    
    return keypair;  // { publicKey, secretKey }
}


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”’ SECURITY IMPROVEMENTS OVER OLD FORMAT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OLD (CryptoJS):               NEW (Fork Architecture V2):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Algorithm: AES-CBC     â”‚   â”‚ Algorithm: AES-GCM             â”‚
â”‚ KDF: PBKDF2            â”‚   â”‚ KDF: Argon2id                  â”‚
â”‚ Iterations: 100k       â”‚   â”‚ Memory: 64 MB                  â”‚
â”‚ No auth separation     â”‚   â”‚ Iterations: 3                  â”‚
â”‚ Server could decrypt   â”‚   â”‚ Fork architecture              â”‚
â”‚                        â”‚   â”‚ Server CANNOT decrypt          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… AES-GCM provides authenticated encryption
âœ… Argon2id is memory-hard (resistant to GPU/ASIC attacks)
âœ… Fork architecture provides host-proof security
âœ… Server authentication separate from vault decryption


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¦ DATABASE RECORD (for Supabase/Backend)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{
    "username": "mac_blackbook",
    "email": "mac@blackbook.io",
    "l1_address": "L1_94B3C863E068096596CE80F04C2233B72AE11790",
    "l2_address": "L2_94B3C863E068096596CE80F04C2233B72AE11790",
    "public_key": "ec6941c71740e192bbf5933d5f9cc18ea161329ce864da900d8de73d45c28752",
    "auth_salt": "c797f810b635e1ea6c19bd0a1f1ef2d40ea565a03fd20eec9aa0350e88fa81a7",
    "vault_salt": "41176c59b52a392d6abaf26857ae97ab97c0733852d81fbd586f08ce12a9492b",
    "vault_ciphertext": "4q/jTciq0L6MaVz5tnLJQ7Rxu/owxXwPu2Fk6LCVHWlyP6O1HHbdEfj5B0bwl+N9XJ9WdCgox3EvBcCjNvSGPJMgHckGha+rO3PFMnTgxD0=",
    "vault_nonce": "7d23f1f893dfdad678080b7d",
    "vault_version": 2,
    "fork_version": 2,
    "created_at": "2026-01-24T05:12:36.477Z",
    "migrated_at": "2026-01-24T05:12:36.478Z"
}

âš ï¸ Server should also store: auth_key_hash = bcrypt(a255598cd1f3685ed953b93ef020757819b5e58427a8428380328806e6c5c805)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š RELATED FILES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

sdk/migrate-mac-wallet.js          - This migration script
sdk/blackbook-wallet-sdk.js        - Production wallet SDK with AES-GCM
mac-wallet-v2-full.json            - Complete migrated wallet data
mac-wallet-v2-vault.json           - Database-ready vault record
tests/js/02-wallet-login.test.js   - Wallet login tests


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     END OF MAC WALLET V2 DOCUMENTATION                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
